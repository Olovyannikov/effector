---
title: –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –≤ effector
description: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ Scope, –∏—Ö —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
---

import Tabs from "@components/Tabs/Tabs.astro";
import TabItem from "@components/Tabs/TabItem.astro";

# Scope: –†–∞–±–æ—Ç–∞ —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏ (#isolated-scopes)

[Scope](/ru/api/effector/Scope) - —ç—Ç–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤ effector. Scope –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∫–æ–ø–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è:

- üóÑÔ∏è Server Side Rendering (SSR)
- üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- üîí –ò–∑–æ–ª—è—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/—Å–µ—Å—Å–∏–π
- üöÄ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

Scope —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é "–≤—Å–µ–ª–µ–Ω–Ω—É—é" –¥–ª—è —é–Ω–∏—Ç–æ–≤ effector, –≥–¥–µ –∫–∞–∂–¥—ã–π —Å—Ç–æ—Ä –∏–º–µ–µ—Ç —Å–≤–æ–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∞ —Å–æ–±—ã—Ç–∏—è –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å —ç—Ç–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ—Ç –¥—Ä—É–≥–∏—Ö scope.

:::info{title="–°–æ–∑–¥–∞–Ω–∏–µ Scope"}
–°–æ–∑–¥–∞—Ç—å scope –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ [fork](/ru/api/effector/fork).
Fork API - —ç—Ç–æ –æ–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö –º–æ—â–Ω—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π effector.
:::

## –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–∫–æ—É–ø –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω (#about-scope)

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ —Å—Ç–æ—Ä—ã –∏ —Å–æ–±—ã—Ç–∏—è –≤ effector —Å—Ç–∞—Ç–∏—á–Ω—ã–µ –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ - –æ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç –æ–¥–Ω–æ –æ–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ù–æ –∏–Ω–æ–≥–¥–∞ –Ω–∞–º –Ω—É–∂–Ω–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
–î–æ–ø—É—Å—Ç–∏–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –∫–∞–∫–æ–π-—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ö–æ—Ç–∏–º –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ –±—É–¥–µ—Ç –±–∞–∑–æ–≤—ã–π —Å—á–µ—Ç—á–∏–∫:

```ts
// counter-store.js
import { createStore, createApi } from "effector";

const $counter = createStore(0);

// —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—é —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ createEvent
// –∏ —Å–≤—è–∑–∏ —Å–æ —Å—Ç–æ—Ä–æ–º —á–µ—Ä–µ–∑ —Å–≤–æ–π—Å—Ç–≤–æ on
const { increment } = createApi($counter, {
  increment: (count) => count + 1,
});
```

–°–æ–∑–¥–∞–¥–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `Counter` –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:

```tsx
// Counter.js
import { useUnit } from "effector-react";
import { $counter, increment } from "./counter-store";

const Counter = () => {
  const count = useUnit($counter);
  const handleIncrement = useUnit(increment);

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={handleIncrement}>+1</button>
    </div>
  );
};
```

–°–µ–π—á–∞—Å, –∫–æ–≥–¥–∞ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `$counter` –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ `Scope`, –º—ã –Ω–∞–∂–º–µ–º –Ω–∞ –∫–Ω–æ–ø–∫—É –∏ —É–≤–µ–ª–∏—á–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è –¥–ª—è –æ–±–æ–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –Ω–∞–ø—Ä—è–º—É—é:

```tsx
// App.tsx
import { Provider, useUnit } from "effector-react";
import { $counter, increment } from "./counter-store";
import { Counter } from "./Counter";

const App = () => {
  return (
    <div>
      <div>
        <h3>First Counter</h3>
        <Counter />
      </div>
      <div>
        <h3>Second Counter</h3>
        <Counter />
      </div>
    </div>
  );
};
```

–û–¥–Ω–∞–∫–æ —ç—Ç–æ –Ω–µ —Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –æ–∂–∏–¥–∞–µ–º.<br/>
–ú—ã —Ö–æ—Ç–∏–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–∞–∫ –≤ —Å–ª—É—á–∞–µ —Å `useState`, –∫–æ–≥–¥–∞ —É –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ, –∞ –Ω–µ –æ–±—â–∏–µ. –í–æ—Ç –∑–¥–µ—Å—å –Ω–∞–º –∏ –ø–æ–º–æ–∂–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç `scope`:

<Tabs>
  <TabItem label="‚úÖ –ß–µ—Ä–µ–∑ Scope">

```tsx
import { useUnit, Provider } from "effector-react";
import { $counter, increment } from "./counter-store";
import { Counter } from "./Counter";

const App = () => {
  // –°–æ–∑–¥–∞–µ–º –¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö scope
  const scope1 = fork();
  const scope2 = fork();

  return (
    <div>
      <Provider value={scope1}>
        <h3>First Counter</h3>
        <Counter />
      </Provider>

      <Provider value={scope2}>
        <h3>Second Counter</h3>
        <Counter />
      </Provider>
    </div>
  );
};
```

  </TabItem>
  <TabItem label="‚ùå –ë–µ–∑ Scope">

```tsx
import { useUnit } from "effector-react";
import { $counter, increment } from "./counter";
import { Counter } from "./Counter";

const App = () => {
  return (
    <div>
      <div>
        <h3>First Counter</h3>
        <Counter />
      </div>
      <div>
        <h3>Second Counter</h3>
        <Counter />
      </div>
    </div>
  );
};
```

  </TabItem>
</Tabs>

:::info{title="–ò–∑–æ–ª—è—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è"}
`Scope` —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –∫–æ–ø–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞. –ü—Ä–∏ —ç—Ç–æ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Å—Ç–æ—Ä –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º!
:::

–ò –≤—É–∞–ª—è, —Ç–µ–ø–µ—Ä—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `Counter` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–≤–æ–∏–º –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º - —ç—Ç–æ –∫–∞–∫ —Ä–∞–∑ —Ç–æ, —á–µ–≥–æ –º—ã –∏ —Ö–æ—Ç–µ–ª–∏. –î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –¥—Ä—É–≥–∏–µ –≤–∞–∂–Ω—ã–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è `Scope`.

:::tip{title="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ Scope"}
–í–∞–º –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Ç–µ–º, —á—Ç–æ–±—ã –∫–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º `scope`. Effector –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–∑–≤–∞—Ç—å —Ü–µ–ø–æ—á–∫—É —Å–æ–±—ã—Ç–∏–µ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —Å–∫–æ–ø–æ–º, –ø—Ä–∏ –ø–æ–º–æ—â–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è `useUnit` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –∏–ª–∏ `allSettled`.
:::

## –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å–æ —Å–∫–æ—É–ø–æ–º (#scope-rules)

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å–æ Scope –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤—ã–∑–æ–≤–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ—Ç–µ—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

### –ü—Ä–∞–≤–∏–ª–∞ –≤—ã–∑–æ–≤–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (#effect-calls-rules)

1. –≠—Ñ—Ñ–µ–∫—Ç—ã –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–∏ –¥—Ä—É–≥–∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
2. –ù–µ–ª—å–∑—è —Å–º–µ—à–∏–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ —Å –æ–±—ã—á–Ω—ã–º–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

<Tabs>
  <TabItem label="‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ">

```ts
const authFx = createEffect(async () => {
  // –ë–µ–∑–æ–ø–∞—Å–Ω–æ - –≤—ã–∑–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–∞ –≤–Ω—É—Ç—Ä–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞
  await loginFx();

  // –ë–µ–∑–æ–ø–∞—Å–Ω–æ - Promise.all —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
  await Promise.all([loadProfileFx(), loadSettingsFx()]);
});
```

  </TabItem>
  <TabItem label="‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ">

```ts
const authFx = createEffect(async () => {
  await loginFx();

  // –ü–æ—Ç–µ—Ä—è scope! –ù–µ–ª—å–∑—è —Å–º–µ—à–∏–≤–∞—Ç—å —Å –æ–±—ã—á–Ω—ã–º–∏ –ø—Ä–æ–º–∏—Å–∞–º–∏
  await new Promise((resolve) => setTimeout(resolve, 100));

  // –≠—Ç–æ—Ç –≤—ã–∑–æ–≤ –±—É–¥–µ—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º scope
  await loadProfileFx();
});
```

  </TabItem>
</Tabs>

–ï—Å–ª–∏ **–Ω–µ** –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è —ç—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª, —Ç–æ —ç—Ç–æ –≥—Ä–æ–∑–∏—Ç [–ø–æ—Ç–µ—Ä–µ–π —Å–∫–æ—É–ø–∞](#scope-loss)!

:::tip{title="‚úÖ –õ—É—á—à–µ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ!"}
–õ—É—á—à–µ –≤—ã–∑—ã–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ, –ø—Ä–∏ –ø–æ–º–æ—â–∏ –º–µ—Ç–æ–¥–∞ `sample`!
:::

## –†–∞–±–æ—Ç–∞ —Å –Ω–∞—á–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (#initial-state)

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ scope —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–¥–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Å—Ç–æ—Ä–æ–≤. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –ø—Ä–∏ SSR –∏–ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –º–æ–∂–Ω–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–µ—Ä–µ–¥–∞—á–∏ —Å–≤–æ–π—Å—Ç–≤–∞ `values` –≤ –ø–µ—Ä–≤—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç –º–µ—Ç–æ–¥–∞ `fork`.
Effector –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ scope:

<Tabs>
  <TabItem label="–ü—Ä–∏ –ø–æ–º–æ—â–∏ Map">

```ts
const scope = fork({
  values: new Map([
    [$store, "value"],
    [$user, { id: 1, name: "Alice" }],
  ]),
});
```

  </TabItem>
  <TabItem label="–ú–∞—Å—Å–∏–≤ –ø–∞—Ä">

```ts
const scope = fork({
  values: [
    [$store, "value"],
    [$user, { id: 1, name: "Alice" }],
  ],
});
```

  </TabItem>
</Tabs>

:::info{title="–ß—Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç values"}
–°–≤–æ–π—Å—Ç–≤–æ `values` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤ —Å–µ–±—è –º–∞—Å—Å–∏–≤ –ø–∞—Ä —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `[$store, value]`.
:::

–≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –≤ —Å–ª—É—á–∞—è—Ö:

- –°–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (SSR) - —á—Ç–æ–±—ã –≥–∏–¥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç –Ω—É–∂–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ SSR (#ssr-usage)

`Scope` —è–≤–ª—è–µ—Ç—Å—è **–∫–ª—é—á–µ–≤—ã–º** –º–µ—Ö–∞–Ω–∏–∑–º–æ–º –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ SSR –≤ effector.
–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ –¥–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞—à–ª–∏ –∫ –≤–∞–º –Ω–∞ —Å–∞–π—Ç –∏ –æ–±–∞ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∑–∞–ø—Ä–æ—Å –æ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∞ —Ç–∞–∫ –∫–∞–∫ —Å—Ç–æ—Ä —É –Ω–∞—Å –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏, —Ç–æ –∑–¥–µ—Å—å –±—ã –Ω–∞—á–∞–ª–æ—Å—å [—Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥–æ–Ω–∫–∏](https://ru.wikipedia.org/wiki/%D0%A1%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5_%D0%B3%D0%BE%D0%BD%D0%BA%D0%B8), –∏ —á–µ–π –±—ã –∑–∞–ø—Ä–æ—Å –æ—Ç—Ä–∞–±–æ—Ç–∞–ª –±—ã—Å—Ç—Ä–µ–µ, —Ç–µ –±—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∏–ª–∏ **–û–ë–ê** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –±—ã –∫ —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

:::warning{title="–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è"}
–ü—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ scope –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Å—Ç–æ—Ä—ã —Å —Ñ–ª–∞–≥–æ–º `{serialize: 'ignore'}`. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —Ñ–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–∫–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
:::

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏ `scope` –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ—é –∫–æ–ø–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è:

<Tabs>
  <TabItem label="üóÑÔ∏è –°–µ—Ä–≤–µ—Ä">

```jsx
// server.tsx
import { renderToString } from "react-dom/server";
import { fork, serialize } from "effector";
import { Provider } from "effector-react";
import { $users, fetchUsersFx } from "./model";

async function serverRender() {
  const scope = fork();

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  await allSettled(fetchUsersFx, { scope });

  // –†–µ–Ω–¥–µ—Ä–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  const html = renderToString(
    <Provider value={scope}>
      <App />
    </Provider>,
  );

  // –°–µ—Ä–∏–∞–ª–∏–∑—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç
  const data = serialize(scope);

  return `
	<html>
	  <body>
		<div id="root">${html}</div>
		<script>window.INITIAL_DATA = ${data}</script>
	  </body>
	</html>
`;
}
```

</TabItem>
<TabItem label="üßë‚Äçüíª –ö–ª–∏–µ–Ω—Ç">

```tsx
// client.tsx
import { hydrateRoot } from "react-dom/client";
import { fork } from "effector";

const scope = fork({
  values: window.INITIAL_DATA,
});

hydrateRoot(
  document.getElementById("root"),
  <Provider value={scope}>
    <App />
  </Provider>,
);
```

</TabItem>
</Tabs>

:::info{title="–ü—Ä–æ allSettled"}
–§—É–Ω–∫—Ü–∏—è [`allSettled`](/ru/api/effector/allSettled) –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤ —Å–µ–±—è —Å–æ–±—ã—Ç–∏–µ, —ç—Ñ—Ñ–µ–∫—Ç –∏–ª–∏ scope, –∂–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ—Ä–æ–∂–¥–µ–Ω–Ω—ã—Ö –∏–º —Å–∞–π–¥-—ç—Ñ—Ñ–µ–∫—Ç–æ–≤. –í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ —ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è –¥–æ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
:::

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã:

1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–∑–¥–∞–µ–º scope –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –≤ –Ω–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –¥–∞–Ω–Ω—ã—Ö
2. –°–µ—Ä–∏–∞–ª–∏–∑—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ scope
3. –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ë–ª–∞–≥–æ–¥–∞—Ä—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Scope –º—ã –æ—á–µ–Ω—å –ª–µ–≥–∫–æ –º–æ–∂–µ–º:

- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- –û–±–µ—Å–ø–µ—á–∏—Ç—å –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏—é –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

:::tip{title="–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö"}
–ú–µ—Ç–æ–¥ [`serialize`](/ru/api/effector/serialize) –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω–æ —Å —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç. –ü—Ä–∏ —ç—Ç–æ–º —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ, –∞ –Ω–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –º–µ—Ç–æ–¥—ã.
:::

–ó–¥–µ—Å—å –º—ã –ø–æ–∫–∞–∑–∞–ª–∏ –≤–∞–º –º–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å SSR, —Å –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã–º –≥–∞–π–¥–æ–º, [–∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å SSR –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç—É—Ç](/ru/guides/server-side-rendering).

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (#scope-for-testing)

Scope —è–≤–ª—è–µ—Ç—Å—è –º–æ—â–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Ç–∞–∫ –∫–∞–∫ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏–π
- –ò–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

```ts
describe("auth flow", () => {
  it("should login user", async () => {
    // –°–æ–∑–¥–∞–µ–º –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π scope –¥–ª—è —Ç–µ—Å—Ç–∞
    const scope = fork();

    // –í—ã–ø–æ–ª–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ª–æ–≥–∏–Ω–∞
    await allSettled(loginFx, {
      scope,
      params: {
        email: "test@example.com",
        password: "123456",
      },
    });

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –≤ —ç—Ç–æ–º scope
    expect(scope.getState($user)).toEqual({
      id: 1,
      email: "test@example.com",
    });
  });

  it("should handle login error", async () => {
    const scope = fork();

    await allSettled(loginFx, {
      scope,
      params: {
        email: "invalid",
        password: "123",
      },
    });

    expect(scope.getState($error)).toBe("Invalid credentials");
    expect(scope.getState($user)).toBeNull();
  });
});
```

### –ú–æ–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (#mocking-effects)

–ü–æ—Ö–æ–∂–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤, —á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–∫ –¥–∞–Ω–Ω—ã—Ö, –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å `handlers` –≤ –æ–±—ä–µ–∫—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–∞:

```ts
// –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –º–æ–∫–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤:
const scope = fork({
  handlers: new Map([
    [effectA, async () => "true"],
    [effectB, async () => ({ id: 1, data: "mock" })],
  ]),
});
```

## –ü–æ—Ç–µ—Ä—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `scope` (#scope-loss)

–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –º—ã –º–æ–∂–µ–º —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å "–ø–æ—Ç–µ—Ä–µ–π" scope. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ JavaScript –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –¥—Ä—É–≥–æ–º —Ü–∏–∫–ª–µ —Å–æ–±—ã—Ç–∏–π (event loop), –≥–¥–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–∂–µ –ø–æ—Ç–µ—Ä—è–Ω. –í –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ scope —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –∫ –º–æ–º–µ–Ω—Ç—É –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–Ω —É–∂–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ç–∞–∫ –∫–∞–∫ effector –Ω–µ –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã.
–≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–∞–∫–∏—Ö API:

- `setTimeout`/`setInterval`
- `addEventListener`
- `webSocket` –∏ –¥—Ä.

### –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Ç–µ—Ä—é scope ? (#how-to-fix-scope-loss)

–ó–¥–µ—Å—å –Ω–∞–º –Ω–∞ –ø–æ–º–æ—â—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –º–µ—Ç–æ–¥ [`scopeBind`](/ru/api/effector/scopeBind). –û–Ω —Å–æ–∑–¥–∞—ë—Ç —Ñ—É–Ω–∫—Ü–∏—é, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—É—é –∫ —Å–∫–æ—É–ø—É –≤ –∫–æ—Ç–æ—Ä–æ–º –º–µ—Ç–æ–¥ –±—ã–ª –≤—ã–∑–≤–∞–Ω, –ø–æ–∑–≤–æ–ª—è—è –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –µ—ë –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä, –≥–¥–µ —É –Ω–∞—Å –µ—Å—Ç—å –¥–≤–∞ —Ç–∞–π–º–µ—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏ –∫–∞–∂–¥—ã–π –∏–∑ –Ω–∏—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, —É –∫–∞–∂–¥–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞ –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è:

- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä - `timerStopped`
- –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–∞–π–º–µ—Ä - `timerStarted`
- –°–±—Ä–æ—Å–∏—Ç—å —Ç–∞–π–º–µ—Ä - `timerReset`

```ts
export const timerStopped = createEvent();
export const timerReset = createEvent();
export const timerStarted = createEvent();
```

–¢–∞–∫–∂–µ —É –Ω–∞—Å –±—É–¥–µ—Ç —Å–æ–±—ã—Ç–∏–µ `tick`, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –º—ã –ø–æ–¥–ø–∏—à–µ–º—Å—è —Å—Ç–æ—Ä–æ–º –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞.
–î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º—ã —Å–æ–∑–¥–∞–¥–∏–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ `$timerCount`.

```ts
const tick = createEvent();

export const $timerCount = createStore(0)
  .on(tick, (seconds) => seconds + 1)
  .reset(timerReset);
```

–ù–µ —Å—Ç–æ–∏—Ç —Ç–∞–∫–∂–µ –∏ –∑–∞–±—ã—Ç—å –æ–± –æ—á–∏—Å—Ç–∫–µ —Ç–∞–π–º–µ—Ä–∞, –¥–ª—è —ç—Ç–æ–≥–æ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ `$timerId`, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `intervalId`.
–ê —Ç–∞–∫–∂–µ –Ω–∞–º –Ω—É–∂–Ω—ã —ç—Ñ—Ñ–µ–∫—Ç—ã:

1. –î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–∞–π–º–µ—Ä–∞
2. –î–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ç–∞–π–º–µ—Ä–∞

```ts
const TIMEOUT = 1_000;

const startFx = createEffect(() => {
  const intervalId = setInterval(() => {
    // –∑–¥–µ—Å—å –≤—Å—è –ø—Ä–æ–±–ª–µ–º–∞
    tick();
  }, TIMEOUT);

  return intervalId;
});

const stopFx = createEffect((timerId: number) => {
  clearInterval(timerId);
});

export const $timerId = createStore<null | number>(null)
  .on(startFx.doneData, (_, timerId) => timerId)
  .on(stopFx.finally, () => null);

sample({
  clock: timerStarted,
  filter: $timerId.map((timerId) => !timerId),
  target: startFx,
});

sample({
  clock: timerStopped,
  source: $timerId,
  filter: Boolean,
  target: stopFx,
});
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –≤—ã–∑–æ–≤ `tick` –≤ `setInterval`, –º—ã –≤—ã–∑—ã–≤–∞–µ–º –µ–≥–æ –Ω–∞–ø—Ä—è–º—É—é. –ó–¥–µ—Å—å –∏ –∫—Ä–æ–µ—Ç—Å—è –≤—Å—è –ø—Ä–æ–±–ª–µ–º–∞, –∫–∞–∫ –º—ã –ø–∏—Å–∞–ª–∏ –≤—ã—à–µ, –∫ –º–æ–º–µ–Ω—Ç—É –≤—ã–∑–æ–≤–∞ tick scope —É–∂–µ –º–æ–≥ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è, –ª–∏–±–æ —É–¥–∞–ª–∏—Ç—å—Å—è - –ø—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è "–ø–æ—Ç–µ—Ä—è—Ç—å—Å—è". –û–¥–Ω–∞–∫–æ –±–ª–∞–≥–æ–¥–∞—Ä—è `scopeBind` –º—ã —Å–≤—è–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏–µ `tick` c –Ω—É–∂–Ω—ã–º –Ω–∞–º —Å–∫–æ—É–ø–æ–º.

<Tabs>
<TabItem label="‚ùå –î–æ">

```ts
const startFx = createEffect(() => {
  const intervalId = setInterval(() => {
    tick();
  }, TIMEOUT);

  return intervalId;
});
```

</TabItem>
<TabItem label="‚úÖ –ü–æ—Å–ª–µ">

```ts
const startFx = createEffect(() => {
  const bindedTick = scopeBind(tick);

  const intervalId = setInterval(() => {
    bindedTick();
  }, TIMEOUT);

  return intervalId;
});
```

</TabItem>
</Tabs>

:::info{title="scopeBind –±–µ–∑ scope?"}
–í–æ–∑–º–æ–∂–Ω–æ –≤—ã —É–∂–µ –∑–∞–º–µ—Ç–∏–ª–∏, —á—Ç–æ –º—ã –Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º –≤ `scopeBind` —Å–∞–º `scope`, —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ —Ç–µ–∫—É—â–∏–π `scope` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –∏ —Ñ—É–Ω–∫—Ü–∏—è `scopeBind` –∑–∞–º—ã–∫–∞–µ—Ç –Ω—É–∂–Ω—ã–π scope –≤ —Å–µ–±–µ –≤ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞. –û–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ, —Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω—É–∂–Ω—ã–π `scope` –≤ –æ–±—ä–µ–∫—Ç–∞ –≤—Ç–æ—Ä–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞.
:::

–ò —Ç–æ–≥–æ –º—ã –∏–º–µ–µ–º:

```ts
import { createEffect, createEvent, createStore, sample, scopeBind } from "effector";

const TIMEOUT = 1_000;

export const timerStopped = createEvent();
export const timerReset = createEvent();
export const timerStarted = createEvent();
const tick = createEvent();

const startFx = createEffect(() => {
  const bindedTick = scopeBind(tick);

  const intervalId = setInterval(() => {
    bindedTick();
  }, TIMEOUT);

  return intervalId;
});

const stopFx = createEffect((timerId: number) => {
  clearInterval(timerId);
});

export const $timerCount = createStore(0)
  .on(tick, (seconds) => seconds + 1)
  .reset(timerReset);

export const $timerId = createStore<null | number>(null, { skipVoid: false })
  .on(startFx.doneData, (_, timerId) => timerId)
  .on(stopFx.finally, () => null);

sample({
  clock: timerStarted,
  filter: $timerId.map((timerId) => !timerId),
  target: startFx,
});

sample({
  clock: timerStopped,
  source: $timerId,
  filter: Boolean,
  target: stopFx,
});
```

–ü—Ä–∏ —ç—Ç–æ–º –Ω–∞—à–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

<Tabs>
<TabItem label="app.tsx">

```tsx
export function App() {
  return (
    <div className="App">
      <Provider value={fork()}>
        Timer A
        <Timer />
      </Provider>
      <Provider value={fork()}>
        Timer B
        <Timer />
      </Provider>
    </div>
  );
}
```

</TabItem>
<TabItem label="timer.tsx">

```tsx
export function Timer() {
  const timerCount = useUnit($timerCount);
  const isRunning = useUnit($timerId);

  const onTimerReset = useUnit(timerReset);
  const onTimerStart = useUnit(timerStarted);
  const onTimerStop = useUnit(timerStopped);

  return (
    <div>
      {isRunning ? (
        <button onClick={() => onTimerStop()}>Stop</button>
      ) : (
        <button onClick={() => onTimerStart()}>Start</button>
      )}
      <button onClick={onTimerReset}>Reset</button>
      timer: {timerCount}
    </div>
  );
}
```

</TabItem>
</Tabs>

–î–ª—è –¥—Ä—É–≥–∏—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ.

–í—ã –º–æ–∂–µ—Ç–µ –ø–æ–∏–≥—Ä–∞—Ç—å —Å —ç—Ç–∏–º –ø—Ä–∏–º–µ—Ä–æ–º [–∑–¥–µ—Å—å](https://stackblitz.com/edit/effector-vite-react-template-ugavudbj?file=src%2Ftimer.tsx)

:::tip{title="Scope –∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏"}
–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ effector –≤ —Å–≤—è–∑–∫–µ —Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏ (React, Vue –∏ —Ç–¥.), —Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö—É–∫ `useUnit` –¥–ª—è —é–Ω–∏—Ç–æ–≤ (store, event –∏ effect), –æ–Ω —Å–∞–º —Å–≤—è–∂–µ—Ç –∏—Ö —Å —Ç–µ–∫—É—â–∏–º —Å–∫–æ—É–ø–æ–º.
:::

### –ü–æ—á–µ–º—É –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–µ—Ä—è scope? (#why-scope-loss)

–ü–æ—Ç–µ—Ä—è scope - —ç—Ç–æ –Ω–µ —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ effector, –∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å—é –≤ JavaScript. –ü—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è. –û–¥–Ω–∞–∫–æ –ø—Ä–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏, –∫–æ–≥–¥–∞ –∫–æ–¥ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ event loop, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–µ—Ä—è –Ω–µ—è–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –º–µ—Å—Ç–∞ –≤—ã–∑–æ–≤–∞ –∏–∑-–∑–∞ –∑–∞–º–µ–Ω—ã call stack.

```ts
const scope = fork();

const nameChanged = createEvent();

const $name = createStore("old name").on(nameChanged, (_, newName) => newName);

const someFx = createEffect(async () => {
  nameChanged("new name");
  // –í –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞ scope —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  console.log($store.getState()); // new name –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ scope

  await somePromise;

  // –ü–æ—Å–ª–µ await scope –ø–æ—Ç–µ—Ä—è–Ω
  console.log($store.getState()); // odl name –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è!
});

await allSettled(someFx, { scope });
```

:::warning{title="–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –ø–æ—Ç–µ—Ä–∏ scope"}
–ü–æ—Ç–µ—Ä—è scope –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ç–æ–º—É, —á—Ç–æ:

- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ –Ω—É–∂–Ω—ã–π scope
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏—Ç –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –±—É–¥—É—Ç –æ—Ç—Ä–∞–∂–µ–Ω—ã –≤ UI
- –í–æ–∑–º–æ–∂–Ω—ã —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –ø—Ä–∏ SSR

:::

–í–æ–∑–º–æ–∂–Ω–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –≤–æ–ø—Ä–æ—Å **"–≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –∏–º–µ–Ω–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–æ—Ä–∞?"**, –æ–¥–Ω–∞–∫–æ —ç—Ç–æ –æ–±—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å—é –≤ JavaScript, –≤—Å–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤—ã–∑–æ–≤—ã —Ç–∞–∫ –∏–ª–∏ –∏–Ω–∞—á–µ –æ–±—Ö–æ–¥—è—Ç —ç—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–∏–µ. –°–∞–º—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–π –ø—Ä–∏–º–µ—Ä —ç—Ç–æ [zone.js](https://github.com/angular/angular/tree/main/packages/zone.js),
–∫–æ—Ç–æ—Ä—ã–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Ä–æ–¥–µ `setTimeout` –∏–ª–∏ `Promise.resolve`. –¢–∞–∫–∂–µ —Å–ø–æ—Å–æ–±–∞–º–∏ —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã –±—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏–ª–∏ `ctx.schedule(() => asyncCall())`.

:::info{title="–ë—É–¥—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ"}
–í JavaScript –≥–æ—Ç–æ–≤–∏—Ç—Å—è proposal [Async Context](https://github.com/tc39/proposal-async-context), –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–∑–≤–∞–Ω —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –ø–æ—Ç–µ—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–∑—ã–∫–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç:

- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ –≤—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã
- –ò–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —è–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è scopeBind
- –ü–æ–ª—É—á–∏—Ç—å –±–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

–ö–∞–∫ —Ç–æ–ª—å–∫–æ —ç—Ç–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤–æ–π–¥–µ—Ç –≤ —è–∑—ã–∫ –∏ –ø–æ–ª—É—á–∏—Ç —à–∏—Ä–æ–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É, effector –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–≥–æ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.
:::
